{% load static %}



{% if tracks %}

<div id="map" style="height: 650px; margin-top: 20px;"></div>  

<script>
    function initMap() 
{
  var map = new google.maps.Map(
    document.getElementById("map"), {
      center: {lat: {{first_track.latitude}}, lng: {{first_track.longitude}} },
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });


  var directionsService = new google.maps.DirectionsService();
  var directionsDisplay = new google.maps.DirectionsRenderer({
    map: map,
    preserveViewport: true
  });

  var startLatLng = {lat: {{first_track.latitude}}, lng: {{first_track.longitude}} };
    var marker = new google.maps.Marker({
        position: startLatLng,
        map,
        icon: "{% static '/img/png/start.png' %}",
        title: 'Day Started - {{first_track.created_at|date:'H:i:s a'}}'
    });
    marker.setMap(map);
    
    var endLatLng = {lat: {{last_track.latitude}}, lng: {{last_track.longitude}} };
    var title_txt = 'Last Location - {{last_track.created_at|date:'H:i:s a'}} '
    var marker = new google.maps.Marker({
        position: endLatLng,
        map,
        icon: "{% static '/img/png/end.png' %}",
        title: title_txt
    });
    marker.setMap(map);
  
    // var waypts = [
    // {% for track in tracks %}
    // { lat: {{track.latitude}}, lng: {{track.longitude}} },
    // {% endfor %}
    // ];
    
    var pathFutureCoordinates = [
        {% for track in tracks %}
          new google.maps.LatLng({{track.latitude}}, {{track.longitude}}),
        {% endfor %}         
      ];

    // for (var i = 0; i < pathFutureCoordinates.length; i++) {
    //     new google.maps.Marker({
    //       map: map,
    //       position: pathFutureCoordinates[i],
    //         icon: "http://maps.google.com/mapfiles/kml/pal4/icon39.png"
    //     });
    //   }

    // var waypts = [
    // {lat: 26.8087524, lng: 81.0119365},
    // {lat: 26.81431833, lng: 81.014445},
    // {lat: 26.81899167, lng: 81.01324667},
    // {lat: 26.82193333, lng: 81.01217667},
    // {lat: 26.823565, lng: 81.01086333},
    // {lat: 26.82988667, lng: 81.01000667},
    // {lat: 26.82998833, lng: 81.00984833},
    // {lat: 26.840875, lng: 81.00954333},
    // {lat: 26.84363667, lng: 80.99880167},
    // {lat: 26.84365167, lng: 80.9988},
    // {lat: 26.84275, lng: 80.9978268},
    // {lat: 26.84613, lng: 80.988275},
    // {lat: 26.84801667, lng: 80.98750333},
    // {lat: 26.84930167, lng: 80.98612833},
    // {lat: 26.84962167, lng: 80.98550167},
    // {lat: 26.84936667, lng: 80.98489167},
    // {lat: 26.84938, lng: 80.98478833},
    // ] 
    
  // directionsDisplay.setDirections(response);
  var polyline = new google.maps.Polyline({
        path: pathFutureCoordinates,
        geodesic: true,
        strokeColor: "#0000FF",
        strokeOpacity: 1.0,
        strokeWeight: 3,
      });

      polyline = new google.maps.Polyline(polyline);
      // var bounds = new google.maps.LatLngBounds();


      // var legs = response.routes[0].legs;
      // for (i = 0; i < legs.length; i++) {
      //   var steps = legs[i].steps;
      //   for (j = 0; j < steps.length; j++) {
      //     var nextSegment = steps[j].path;
      //     for (k = 0; k < nextSegment.length; k++) {
      //       polyline.getPath().push(nextSegment[k]);
      //       bounds.extend(nextSegment[k]);
      //     }
      //   }
      // }

      polyline.setMap(map);
}

    // function initMap() {

    //     {% if tracks %}
        
    //     var directionsService = new google.maps.DirectionsService;
    //     var directionsRenderer = new google.maps.DirectionsRenderer({
    //         markerOptions:{
    //             visible:false,
                
    //         },
    //     });
    //     map = new google.maps.Map(document.getElementById('map'), {
    //         zoom: 12,
    //         suppressMarkers: true,
    //         center: {lat: {{first_track.latitude}}, lng: {{first_track.longitude}} },
    //         mapTypeId: google.maps.MapTypeId.ROADMAP
    //     });
    //     directionsRenderer.setMap(map);
        
    //     var startLatLng = {lat: {{first_track.latitude}}, lng: {{first_track.longitude}} };
    //     var marker = new google.maps.Marker({
    //         position: startLatLng,
    //         map,
    //         icon: "{% static '/img/png/start.png' %}",
    //         title: 'Day Started - {{first_track.created_at|date:'H:i:s a'}}'
    //     });
    //     marker.setMap(map);
        
    //     var endLatLng = {lat: {{last_track.latitude}}, lng: {{last_track.longitude}} };
    //     var marker = new google.maps.Marker({
    //         position: endLatLng,
    //         map,
    //         icon: "{% static '/img/png/end.png' %}",
    //         title: 'Last Location - {{last_track.created_at|date:'H:i:s a'}} '
    //     });
    //     marker.setMap(map);
        
        
    //     {% for track in tracks %}
    //     {% if not forloop.first and not forloop.last %}
    //     var middleLatLng = {lat: {{track.latitude}}, lng: {{track.longitude}}};
    //     var marker = new google.maps.Marker({
    //         position: middleLatLng,
    //         map,
    //         icon: "{% static '/img/png/walk.gif' %}",
    //         title: 'Poll Time - {{track.created_at|date:'H:i:s a'}}'
    //     });
    //     marker.setMap(map);
    //     {% endif %}
    //     {% endfor %}
        
        
    //     calculateAndDisplayRoute(directionsService, directionsRenderer);
        
        
    // }
    
    // function calculateAndDisplayRoute(directionsService, directionsRenderer) {
    //     var waypts = [];
    //     counter = 0
    //     {% for track in tracks %}
        
    //     if(counter < 20)
    //         waypts.push({
    //             location: new google.maps.LatLng({{track.latitude}},{{track.longitude}}),
    //             stopover: true
    //         });
    //     counter = counter+1;
    //     {% endfor %}
        
    //     waypts.push({
    //         location: new google.maps.LatLng({{last_track.latitude}},{{last_track.longitude}}),
    //         stopover: true
    //     });
        
        
        
        
    //     directionsService.route({
    //         origin: new google.maps.LatLng({{first_track.latitude}},{{first_track.longitude}}),
    //         destination: new google.maps.LatLng({{last_track.latitude}},{{last_track.longitude}}),
    //         waypoints: waypts,
    //         optimizeWaypoints: true,
    //         travelMode: 'DRIVING'
    //     }, function(response, status) {
    //         if (status === 'OK') {
    //             directionsRenderer.setDirections(response);
    //             var route = response.routes[0];
    //         } else {
    //             window.alert('Directions request failed due to ' + status);
    //         }
    //     });
        
    //     {% else %}
        
    //     map = new google.maps.Map(document.getElementById('map'), {
    //         zoom: 12,
    //         center: new google.maps.LatLng({{org_latitude}}, {{org_longitude}}),
    //         mapTypeId: google.maps.MapTypeId.ROADMAP
    //     });
        
    //     {% endif %}
        
    // }
    
    
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNCcTQduJoNRebWEf7zgqlpe1YJibSuGI&callback=initMap&libraries=&v=weekly">
</script>
<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5Pmv2She9T2jPiTwiNfcRrrP7Jcf2lCg&callback=initMap&libraries=&v=weekly"> -->
    <!-- </script> -->

    
    {% else %}
    <div class="no_track_section">
    </div>

    {% endif %}
    <script>
        $('#travell_id').html('{{distance_travelleds}}')
        {% if start_time %}
        $('#start_time').html('{{start_time}}')
        {% else %}
        $('#start_time').html('-')
        {% endif %}
        
        {% if end_time %}
        $('#end_time').html('{{end_time}}')
        {% else %}
        $('#end_time').html('-')
        {% endif %}
     
        
        
    
        
    </script>